<!DOCTYPE html>
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
      <link rel="stylesheet" type="text/css"href="dark.css">
      <script type="text/javascript">
         var socket = null;
         var isopen = false;
         socket = new WebSocket("ws://127.0.0.1:9000");
         
         socket.onopen = function() {
            console.log("Connected!");
            isopen = true;
            document.getElementById('status').innerText = "OPENED";
         };

         socket.onmessage = function(e) {
            console.log("RX: " + e.data);
            var value_field = document.getElementById('value');
            var interval_field = document.getElementById('interval');

            var result = JSON.parse(e.data) // parse string to object
            for (var key in result){         // iterate over the object and get keys and values
               //console.log(key+" is "+result[key])
               if (key == "value"){value_field.innerText = key + " : " + result[key]};
               if (key == "interval"){interval_field.innerText = result[key]};
            }
         };

         socket.onclose = function(e) {
            console.log("Connection closed.");
            document.getElementById('status').innerText = "CLOSED";
            socket = null;
            isopen = false;
         };

         window.onclose = function(){
            disconnect();
         };

         function disconnect(){
            socket.close();
         };

        
         
         function sendText(key, value) {
            if (isopen) {
               jsonstring = JSON.stringify({[key] : value}) // [] needed to avoid taking "key literally"
               socket.send(jsonstring);
               console.log("TX: "+ jsonstring);               
            } else {
               console.log("Connection not opened.")
            }
         };
      </script>
   </head>
   <body>
      <hr>
      STATUS: <div id="status">--</div> 
      <button onclick='disconnect();'>CLOSE</button>
      <br>

      INTERVAL: <div id="interval">--</div>s  
      <button onclick='sendText("interval", 1);'>1</button>
      <button onclick='sendText("interval", 3);'>3</button>
      <button onclick='sendText("interval", 5);'>5</button>

      <hr>

      <br>
      <div id="value">--</div>
      
   </body>
</html>