<!DOCTYPE html>
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
      <style>
         div{
            display: inline-block;
         }
      
      </style>
      <script type="text/javascript">
         var socket = null;
         var isopen = false;

         

         socket = new WebSocket("ws://127.0.0.1:9000");
         socket.onopen = function() {
            console.log("Connected!");
            isopen = true;
            document.getElementById('status').innerText = "CONNECTED";
         }

         socket.onmessage = function(e) {
            console.log("Text message received: " + e.data);
            var value_field = document.getElementById('value');
            var interval_field = document.getElementById('interval');
            

            var jsonparsed = JSON.parse(e.data); // read data and parse json
            value_field.innerText = jsonparsed.value; // update div with the right part of json
            interval_field.innerText = jsonparsed.interval; // update div with the right part of json

         }

         window.onclose = function(){
            socket.close();
         };

         window.onbeforeunload = function() {
            socket.onclose = function () {}; // disable onclose handler first
            socket.close();
         };
         function disco(){
            socket.close();
         }

         socket.onclose = function(e) {
            console.log("Connection closed.");
            document.getElementById('status').innerText = "XX CLOSED XX";
            socket = null;
            isopen = false;
         };

         
         
         
         function sendText() {
            if (isopen) {
               socket.send("1");
               console.log("set to 1");               
            } else {
               console.log("Connection not opened.")
            }
         };
         function sendBinary() {
            if (isopen) {
               socket.send("5");
               console.log("set to 5");               
            } else {
               console.log("Connection not opened.")
            }
         };
      </script>
   </head>
   <body>
      <p>server sends json message every second, client can modify value of that message and see it update</p>
      <p>F12 for console</p>
      
      
      <hr>
      STATUS: <div id="status">--</div> <button onclick='disco();'>CLOSE</button>
      <hr>

      Interval: <div id="interval">--</div>s  
      <button onclick='sendText();'>1</button>
      <button onclick='sendBinary();'>5</button> <br>
      Value: <div id="value">--</div>
      
      
   </body>
</html>